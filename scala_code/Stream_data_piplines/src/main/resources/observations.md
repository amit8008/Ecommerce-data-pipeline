# Tumbling Window V/S Sliding Window
```
-------------------------------------------
Batch: 0
-------------------------------------------
+------------------------------------------+----+-----+
|window                                    |User|count|
+------------------------------------------+----+-----+
|{2015-02-23 15:40:00, 2015-02-23 15:50:00}|g   |121  |
|{2015-02-23 15:50:00, 2015-02-23 16:00:00}|g   |1165 |
|{2015-02-23 16:00:00, 2015-02-23 16:10:00}|g   |1267 |
|{2015-02-23 16:10:00, 2015-02-23 16:20:00}|g   |1121 |
|{2015-02-23 16:20:00, 2015-02-23 16:30:00}|g   |2119 |
|{2015-02-23 16:30:00, 2015-02-23 16:40:00}|g   |1342 |
|{2015-02-23 16:40:00, 2015-02-23 16:50:00}|g   |1136 |
|{2015-02-23 16:50:00, 2015-02-23 17:00:00}|g   |896  |
+------------------------------------------+----+-----+

-------------------------------------------
Batch: 1
-------------------------------------------
+------------------------------------------+----+-----+
|window                                    |User|count|
+------------------------------------------+----+-----+
|{2015-02-23 15:40:00, 2015-02-23 15:50:00}|g   |294  |
|{2015-02-23 15:50:00, 2015-02-23 16:00:00}|g   |2458 |
|{2015-02-23 16:00:00, 2015-02-23 16:10:00}|g   |2518 |
|{2015-02-23 16:10:00, 2015-02-23 16:20:00}|g   |2240 |
|{2015-02-23 16:20:00, 2015-02-23 16:30:00}|g   |4049 |
|{2015-02-23 16:30:00, 2015-02-23 16:40:00}|g   |2647 |
|{2015-02-23 16:40:00, 2015-02-23 16:50:00}|g   |2263 |
|{2015-02-23 16:50:00, 2015-02-23 17:00:00}|g   |1866 |
+------------------------------------------+----+-----+
-------------------------------------------
Batch: 0
-------------------------------------------
+------------------------------------------+----+-----+
|window                                    |User|count|
+------------------------------------------+----+-----+
|{2015-02-23 15:40:00, 2015-02-23 15:50:00}|g   |121  |
|{2015-02-23 15:45:00, 2015-02-23 15:55:00}|g   |656  |
|{2015-02-23 15:50:00, 2015-02-23 16:00:00}|g   |1165 |
|{2015-02-23 15:55:00, 2015-02-23 16:05:00}|g   |1218 |
|{2015-02-23 16:00:00, 2015-02-23 16:10:00}|g   |1267 |
|{2015-02-23 16:05:00, 2015-02-23 16:15:00}|g   |1250 |
|{2015-02-23 16:10:00, 2015-02-23 16:20:00}|g   |1121 |
|{2015-02-23 16:15:00, 2015-02-23 16:25:00}|g   |1729 |
|{2015-02-23 16:20:00, 2015-02-23 16:30:00}|g   |2119 |
|{2015-02-23 16:25:00, 2015-02-23 16:35:00}|g   |1567 |
|{2015-02-23 16:30:00, 2015-02-23 16:40:00}|g   |1342 |
|{2015-02-23 16:35:00, 2015-02-23 16:45:00}|g   |1259 |
|{2015-02-23 16:40:00, 2015-02-23 16:50:00}|g   |1136 |
|{2015-02-23 16:45:00, 2015-02-23 16:55:00}|g   |1147 |
|{2015-02-23 16:50:00, 2015-02-23 17:00:00}|g   |896  |
|{2015-02-23 16:55:00, 2015-02-23 17:05:00}|g   |341  |
+------------------------------------------+----+-----+

-------------------------------------------
Batch: 1
-------------------------------------------
+------------------------------------------+----+-----+
|window                                    |User|count|
+------------------------------------------+----+-----+
|{2015-02-23 15:40:00, 2015-02-23 15:50:00}|g   |294  |
|{2015-02-23 15:45:00, 2015-02-23 15:55:00}|g   |1367 |
|{2015-02-23 15:50:00, 2015-02-23 16:00:00}|g   |2458 |
|{2015-02-23 15:55:00, 2015-02-23 16:05:00}|g   |2538 |
|{2015-02-23 16:00:00, 2015-02-23 16:10:00}|g   |2518 |
|{2015-02-23 16:05:00, 2015-02-23 16:15:00}|g   |2493 |
|{2015-02-23 16:10:00, 2015-02-23 16:20:00}|g   |2240 |
|{2015-02-23 16:15:00, 2015-02-23 16:25:00}|g   |3369 |
|{2015-02-23 16:20:00, 2015-02-23 16:30:00}|g   |4049 |
|{2015-02-23 16:25:00, 2015-02-23 16:35:00}|g   |3001 |
|{2015-02-23 16:30:00, 2015-02-23 16:40:00}|g   |2647 |
|{2015-02-23 16:35:00, 2015-02-23 16:45:00}|g   |2529 |
|{2015-02-23 16:40:00, 2015-02-23 16:50:00}|g   |2263 |
|{2015-02-23 16:45:00, 2015-02-23 16:55:00}|g   |2306 |
|{2015-02-23 16:50:00, 2015-02-23 17:00:00}|g   |1866 |
|{2015-02-23 16:55:00, 2015-02-23 17:05:00}|g   |732  |
+------------------------------------------+----+-----+

```


## With or without withWatermark 


### without withWatermark
```
without watermark

24/12/19 23:55:39 WARN ResolveWriteToStream: Temporary checkpoint location created which is deleted normally when the query didn't fail: C:\Users\amit8\AppData\Local\Temp\temporary-af4de2ae-306b-4cee-9e62-94cdb6fbfeb0. If it's required to delete it under any circumstances, please set spark.sql.streaming.forceDeleteTempCheckpointLocation to true. Important to know deleting temp checkpoint folder is best effort.
24/12/19 23:55:39 WARN ResolveWriteToStream: spark.sql.adaptive.enabled is not supported in streaming DataFrames/Datasets and will be disabled.
-------------------------------------------
Batch: 0
-------------------------------------------
+------------------------------------------+----+-----+
|window                                    |User|count|
+------------------------------------------+----+-----+
|{2015-02-23 15:40:00, 2015-02-23 15:50:00}|g   |121  |
|{2015-02-23 15:45:00, 2015-02-23 15:55:00}|g   |656  |
|{2015-02-23 15:50:00, 2015-02-23 16:00:00}|g   |1165 |
|{2015-02-23 15:55:00, 2015-02-23 16:05:00}|g   |1218 |
|{2015-02-23 16:00:00, 2015-02-23 16:10:00}|g   |1267 |

```

### with withWatermark

```

Exception in thread "main" org.apache.spark.sql.AnalysisException: checkpointLocation must be specified either through option("checkpointLocation", ...) or SparkSession.conf.set("spark.sql.streaming.checkpointLocation", ...).
	at org.apache.spark.sql.errors.QueryCompilationErrors$.checkpointLocationNotSpecifiedError(QueryCompilationErrors.scala:2992)
	at org.apache.spark.sql.execution.streaming.ResolveWriteToStream$.$anonfun$resolveCheckpointLocation$5(ResolveWriteToStream.scala:95)

```
**To resolve this add checkpoint location**
.config("spark.sql.streaming.checkpointLocation","C:\\Users\\amit8\\AppData\\Local\\Temp")
```
-------------------------------------------
Batch: 0
-------------------------------------------
+------------------------------------------+----+-----+
|window                                    |User|count|
+------------------------------------------+----+-----+
|{2015-02-23 15:40:00, 2015-02-23 15:50:00}|g   |121  |
|{2015-02-23 15:45:00, 2015-02-23 15:55:00}|g   |656  |
|{2015-02-23 15:50:00, 2015-02-23 16:00:00}|g   |1165 |
|{2015-02-23 15:55:00, 2015-02-23 16:05:00}|g   |1218 |
|{2015-02-23 16:00:00, 2015-02-23 16:10:00}|g   |1267 |
|{2015-02-23 16:05:00, 2015-02-23 16:15:00}|g   |1250 |
|{2015-02-23 16:10:00, 2015-02-23 16:20:00}|g   |1121 |
|{2015-02-23 16:15:00, 2015-02-23 16:25:00}|g   |1729 |
|{2015-02-23 16:20:00, 2015-02-23 16:30:00}|g   |2119 |
|{2015-02-23 16:25:00, 2015-02-23 16:35:00}|g   |1567 |
|{2015-02-23 16:30:00, 2015-02-23 16:40:00}|g   |1342 |
|{2015-02-23 16:35:00, 2015-02-23 16:45:00}|g   |1259 |
|{2015-02-23 16:40:00, 2015-02-23 16:50:00}|g   |1136 |
|{2015-02-23 16:45:00, 2015-02-23 16:55:00}|g   |1147 |
|{2015-02-23 16:50:00, 2015-02-23 17:00:00}|g   |896  |
|{2015-02-23 16:55:00, 2015-02-23 17:05:00}|g   |341  |
+------------------------------------------+----+-----+

-------------------------------------------
Batch: 1
-------------------------------------------
+------------------------------------------+----+-----+
|window                                    |User|count|
+------------------------------------------+----+-----+
|{2015-02-23 15:40:00, 2015-02-23 15:50:00}|g   |294  |
|{2015-02-23 15:45:00, 2015-02-23 15:55:00}|g   |1367 |
|{2015-02-23 15:50:00, 2015-02-23 16:00:00}|g   |2458 |
|{2015-02-23 15:55:00, 2015-02-23 16:05:00}|g   |2538 |
|{2015-02-23 16:00:00, 2015-02-23 16:10:00}|g   |2518 |
|{2015-02-23 16:05:00, 2015-02-23 16:15:00}|g   |2493 |
|{2015-02-23 16:10:00, 2015-02-23 16:20:00}|g   |2240 |
|{2015-02-23 16:15:00, 2015-02-23 16:25:00}|g   |3369 |
|{2015-02-23 16:20:00, 2015-02-23 16:30:00}|g   |4049 |
|{2015-02-23 16:25:00, 2015-02-23 16:35:00}|g   |3001 |
|{2015-02-23 16:30:00, 2015-02-23 16:40:00}|g   |2647 |
|{2015-02-23 16:35:00, 2015-02-23 16:45:00}|g   |2529 |
|{2015-02-23 16:40:00, 2015-02-23 16:50:00}|g   |2263 |
|{2015-02-23 16:45:00, 2015-02-23 16:55:00}|g   |2306 |
|{2015-02-23 16:50:00, 2015-02-23 17:00:00}|g   |1866 |
|{2015-02-23 16:55:00, 2015-02-23 17:05:00}|g   |732  |
+------------------------------------------+----+-----+

```
## with or withour dropDuplicate

### with dropDuplicate

```
-------------------------------------------
Batch: 0
-------------------------------------------
+----+-----+
|User|count|
+----+-----+
|g   |9167 |
+----+-----+

-------------------------------------------
Batch: 1
-------------------------------------------
+----+-----+
|User|count|
+----+-----+
|g   |18335|
+----+-----+
```

### without dropDuplicate 

```
-------------------------------------------
Batch: 0
-------------------------------------------
+----+-----+
|User|count|
+----+-----+
|g   |9167 |
+----+-----+

-------------------------------------------
Batch: 1
-------------------------------------------
+----+-----+
|User|count|
+----+-----+
|g   |18335|
+----+-----+
```

No Duplicate data

### Sessionization
result:
```
-------------------------------------------
Batch: 0
-------------------------------------------
+---+-----------------------------------+----------------------+
|uid|activities                         |xAvg                  |
+---+-----------------------------------+----------------------+
|g  |[stand, null, sit]                 |9.503131068931047E-4  |
|g  |[sit, null, walk]                  |-0.003911539594705299 |
|g  |[walk, null, stairsup, stairsdown] |0.006775755819180794  |
|g  |[stairsup, stairsdown, null, stand]|-0.0063115139855144855|
|g  |[stand, null, bike]                |-0.005008800345454542 |
|g  |[null, bike, sit]                  |0.009768445289510473  |
|g  |[null, walk]                       |-0.008306115820179816 |
|g  |[walk, null, stairsup, stairsdown] |-0.04473407478381612  |
|g  |[stairsup, stairsdown, null, bike] |0.014556457469030979  |
|f  |[stand, null, sit]                 |-0.0023608441174825163|
|f  |[sit, null, walk]                  |-0.004913223305294707 |
|f  |[walk, null, stairsup, stairsdown] |0.0160425360928072    |
|f  |[stairsup, stairsdown, null]       |0.003396947798301696  |
|f  |[null, bike, stand]                |-0.014037704957042948 |
|f  |[bike, stand, null, sit]           |-0.004087968191908097 |
|f  |[sit, null, walk, stairsup]        |-0.00771486496063937  |
|f  |[stairsup, stairsdown]             |0.0205320343027972    |
|f  |[stairsdown, null, bike]           |-0.014745645214985002 |
|e  |[stand, null, sit]                 |0.0011748657809190757 |
|e  |[sit, null, walk]                  |0.004898909663736261  |
+---+-----------------------------------+----------------------+
only showing top 20 rows
```

Getting error
```
24/12/21 19:26:59 ERROR Utils: Aborting task
java.lang.IllegalArgumentException: Timeout timestamp (1424688233181) cannot be earlier than the current watermark (1424789505905)
```